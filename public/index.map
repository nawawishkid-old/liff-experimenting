{"version":3,"sources":["fieldNameParser.js","index.js"],"names":["parseManyFieldNames","fields","starterObj","delimiter","reduce","obj","field","parseFieldName","name","value","splittedName","split","keys","slice","key","index","isLastIndex","Array","isArray","isNaN","parseInt","Error","handleLastIndex","valueShouldBeArray","handleArrayProperty","handleNormal","slicedKey","prop","isPropExists","window","onload","liff","init","data","initProfileUi","err","document","getElementById","classList","remove","querySelectorAll","forEach","handleEachForm","form","elements","filter","elem","tagName","addEventListener","e","validateField","target","preventDefault","checkValidity","liffMessageData","fieldNameParser","console","log","sendMessages","createResponse","messages","node","dataset","messageType","validity","validationMessage","messageDom","parentElement","querySelector","valid","message","patternMismatch","errorMessagePattern","add","innerHTML","notiDom","for","method","contains","type","dom","createElement","responsesBox","appendChild","setTimeout","firstElementChild","removeChild","getProfile","then","profile","displayName","pictureUrl","profileImageDom","userGreetingDom","profileNameP","textContent","src","catch"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACC,MAAD;AAAA,MAASC,UAAT,uEAAsB,EAAtB;AAAA,MAA0BC,SAA1B,uEAAsC,GAAtC;AAAA,SAC1BF,MAAM,CAACG,MAAP,CACE,UAACC,GAAD,EAAMC,KAAN;AAAA,WAAgBC,cAAc,CAACD,KAAD,EAAQD,GAAR,CAA9B;AAAA,GADF,EAEEH,UAFF,EAGEC,SAHF,CAD0B;AAAA,CAA5B;;;;AAOA,IAAMI,cAAc,GAAG,SAAjBA,cAAiB,CAACD,KAAD,EAA6C;AAAA,MAArCJ,UAAqC,uEAAxB,EAAwB;AAAA,MAApBC,SAAoB,uEAAR,GAAQ;AAAA,MAC1DK,IAD0D,GAC1CF,KAD0C,CAC1DE,IAD0D;AAAA,MACpDC,KADoD,GAC1CH,KAD0C,CACpDG,KADoD;AAElE,MAAMC,YAAY,GAAGF,IAAI,CAACG,KAAL,CAAWR,SAAX,CAArB,CAFkE,CAGlE;;AACA,MAAMS,IAAI,GAAGF,YAAY,CAACG,KAAb,CAAmB,CAAnB,CAAb;AAEAD,EAAAA,IAAI,CAACR,MAAL,CAAY,UAACC,GAAD,EAAMS,GAAN,EAAWC,KAAX,EAAqB;AAC/B,QAAMC,WAAW,GAAG,CAACJ,IAAI,CAACG,KAAK,GAAG,CAAT,CAAL,GAAmB,IAAnB,GAA0B,KAA9C;;AAEA,QAAIE,KAAK,CAACC,OAAN,CAAcb,GAAd,KAAsBc,KAAK,CAACC,QAAQ,CAACN,GAAD,CAAT,CAA/B,EAAgD;AAC9C,YAAM,IAAIO,KAAJ,CACJ,wDAAwDP,GAAxD,GAA8D,SAD1D,CAAN;AAGD;;AAED,QAAIE,WAAJ,EAAiB;AACf,aAAOM,eAAe,CAACjB,GAAD,EAAMS,GAAN,EAAWL,KAAX,CAAtB;AACD,KAX8B,CAa/B;;;AACA,QAAMc,kBAAkB,GAAGT,GAAG,CAACD,KAAJ,CAAU,CAAC,CAAX,MAAkB,IAA7C;;AAEA,QAAIU,kBAAJ,EAAwB;AACtB,aAAOC,mBAAmB,CAACnB,GAAD,EAAMS,GAAN,CAA1B;AACD;;AAED,WAAOW,YAAY,CAACpB,GAAD,EAAMS,GAAN,CAAnB;AACD,GArBD,EAqBGZ,UArBH;AAuBA,SAAOA,UAAP;AACD,CA9BD;AAgCA;;;;;;;;;AAKA,IAAMoB,eAAe,GAAG,SAAlBA,eAAkB,CAACjB,GAAD,EAAMS,GAAN,EAAWL,KAAX,EAAqB;AAC3CJ,EAAAA,GAAG,CAACS,GAAD,CAAH,GAAWL,KAAX;AAEA,SAAOJ,GAAP;AACD,CAJD;;AAKA,IAAMmB,mBAAmB,GAAG,SAAtBA,mBAAsB,CAACnB,GAAD,EAAMS,GAAN,EAAc;AACxC;AACA,MAAMY,SAAS,GAAGZ,GAAG,CAACD,KAAJ,CAAU,CAAV,EAAa,CAAC,CAAd,CAAlB;AACA,MAAMc,IAAI,GAAGtB,GAAG,CAACqB,SAAD,CAAhB,CAHwC,CAKxC;AACA;;AACA,MAAIE,YAAY,CAACvB,GAAD,EAAMqB,SAAN,CAAhB,EAAkC;AAChC,WAAOC,IAAP;AACD;;AAEDtB,EAAAA,GAAG,CAACqB,SAAD,CAAH,GAAiB,EAAjB;AAEA,SAAOrB,GAAG,CAACqB,SAAD,CAAV;AACD,CAdD;;AAeA,IAAMD,YAAY,GAAG,SAAfA,YAAe,CAACpB,GAAD,EAAMS,GAAN,EAAc;AACjC;AACA;AACA,MAAIc,YAAY,CAACvB,GAAD,EAAMS,GAAN,CAAhB,EAA4B;AAC1B,WAAOT,GAAG,CAACS,GAAD,CAAV;AACD,GALgC,CAOjC;AACA;;;AACAT,EAAAA,GAAG,CAACS,GAAD,CAAH,GAAW,EAAX;AAEA,SAAOT,GAAG,CAACS,GAAD,CAAV;AACD,CAZD;;AAaA,IAAMc,YAAY,GAAG,SAAfA,YAAe,CAACvB,GAAD,EAAMS,GAAN;AAAA,SAAc,OAAOT,GAAG,CAACS,GAAD,CAAV,KAAoB,WAAlC;AAAA,CAArB;;;;AC7EA;;;;;;;;;;;;AAEA;AACAe,MAAM,CAACC,MAAP,GAAgB,YAAM;AACpBC,EAAAA,IAAI,CAACC,IAAL,CACE,UAAAC,IAAI;AAAA,WAAIC,aAAa,EAAjB;AAAA,GADN,EAEE,UAAAC,GAAG,EAAI;AACL;AACAC,IAAAA,QAAQ,CAACC,cAAT,CAAwB,eAAxB,EAAyCC,SAAzC,CAAmDC,MAAnD,CAA0D,cAA1D,EAFK,CAGL;;AACAH,IAAAA,QAAQ,CACLC,cADH,CACkB,sBADlB,EAEGC,SAFH,CAEaC,MAFb,CAEoB,UAFpB;AAGD,GATH;AAWD,CAZD,EAcA;;;AACAH,QAAQ,CAACI,gBAAT,CAA0B,MAA1B,EAAkCC,OAAlC,CAA0C,SAASC,cAAT,CAAwBC,IAAxB,EAA8B;AACtE,MAAM1C,MAAM,GAAG,mBAAI0C,IAAI,CAACC,QAAT,EAAmBC,MAAnB,CAA0B,UAAAC,IAAI;AAAA,WAAIA,IAAI,CAACC,OAAL,KAAiB,QAArB;AAAA,GAA9B,CAAf,CADsE,CAGtE;;;AACA9C,EAAAA,MAAM,CAACwC,OAAP,CAAe,UAAAnC,KAAK;AAAA,WAClBA,KAAK,CAAC0C,gBAAN,CAAuB,OAAvB,EAAgC,UAAAC,CAAC;AAAA,aAAIC,aAAa,CAACD,CAAC,CAACE,MAAH,CAAjB;AAAA,KAAjC,CADkB;AAAA,GAApB,EAJsE,CAQtE;;AACAR,EAAAA,IAAI,CAACK,gBAAL,CAAsB,QAAtB,EAAgC,UAASC,CAAT,EAAY;AAC1CA,IAAAA,CAAC,CAACG,cAAF;AAEAnD,IAAAA,MAAM,CAACwC,OAAP,CAAeS,aAAf;;AAEA,QAAI,CAAC,KAAKG,aAAL,EAAL,EAA2B;AACzB;AACD;;AAED,QAAMC,eAAe,GAAGC,eAAe,CAACvD,mBAAhB,CAAoCC,MAApC,CAAxB;AAEAuD,IAAAA,OAAO,CAACC,GAAR,CAAY,wBAAZ;AACAD,IAAAA,OAAO,CAACC,GAAR,CAAY,mBAAZ,EAAiCH,eAAjC;;AAEA,QAAI,OAAOvB,IAAI,CAAC2B,YAAZ,KAA6B,WAAjC,EAA8C;AAC5CC,MAAAA,cAAc,CAAC,SAAD,EAAY,yBAAZ,CAAd;AAEA;AACD;;AAED5B,IAAAA,IAAI,CAAC2B,YAAL,CAAkBE,QAAQ,CAACC,IAAI,CAACC,OAAL,CAAaC,WAAd,CAA1B;AACAJ,IAAAA,cAAc,CAAC,SAAD,EAAY,eAAZ,CAAd;AACD,GAtBD;AAuBD,CAhCD,GAkCA;;AACA,SAAST,aAAT,CAAuB5C,KAAvB,EAA8B;AAAA,MACpB0D,QADoB,GACY1D,KADZ,CACpB0D,QADoB;AAAA,MACVC,iBADU,GACY3D,KADZ,CACV2D,iBADU;AAE5B,MAAMC,UAAU,GAAG5D,KAAK,CAAC6D,aAAN,CAAoBA,aAApB,CAAkCC,aAAlC,CACjB,kBADiB,CAAnB;;AAIA,MAAI,CAACJ,QAAQ,CAACK,KAAd,EAAqB;AACnB,QAAMC,OAAO,GAAGN,QAAQ,CAACO,eAAT,GACZjE,KAAK,CAACwD,OAAN,CAAcU,mBADF,GAEZP,iBAFJ;AAIA3D,IAAAA,KAAK,CAACgC,SAAN,CAAgBC,MAAhB,CAAuB,YAAvB;AACAjC,IAAAA,KAAK,CAACgC,SAAN,CAAgBmC,GAAhB,CAAoB,WAApB;AACAP,IAAAA,UAAU,CAACQ,SAAX,GAAuBJ,OAAO,IAAIL,iBAAlC;AAEA,WAAO,IAAP;AACD,GAVD,MAUO;AACL3D,IAAAA,KAAK,CAACgC,SAAN,CAAgBC,MAAhB,CAAuB,WAAvB;AACAjC,IAAAA,KAAK,CAACgC,SAAN,CAAgBmC,GAAhB,CAAoB,YAApB;AACAP,IAAAA,UAAU,CAACQ,SAAX,GAAuB,EAAvB;AAEA,WAAO,KAAP;AACD;AACF,EAED;;;AACAtC,QAAQ,CAACI,gBAAT,CAA0B,+BAA1B,EAA2DC,OAA3D,CAAmE,UAAAK,IAAI;AAAA,SACrEA,IAAI,CAACE,gBAAL,CAAsB,OAAtB,EAA+B,YAAW;AACxCQ,IAAAA,OAAO,CAACC,GAAR,CAAY,2BAAZ;AACA,QAAMkB,OAAO,GAAGvC,QAAQ,CAACgC,aAAT,mDAC6B,KAAKN,OAAL,CAAac,GAD1C,OAAhB;AAGA,QAAMC,MAAM,GAAGF,OAAO,CAACrC,SAAR,CAAkBwC,QAAlB,CAA2B,UAA3B,IAAyC,QAAzC,GAAoD,KAAnE;AAEAH,IAAAA,OAAO,CAACrC,SAAR,CAAkBuC,MAAlB,EAA0B,UAA1B;AACD,GARD,CADqE;AAAA,CAAvE,GAYA;;AACAzC,QAAQ,CACLI,gBADH,CACoB,gCADpB,EAEGC,OAFH,CAEW,UAAAK,IAAI;AAAA,SACXA,IAAI,CACDsB,aADH,CACiB,SADjB,EAEGpB,gBAFH,CAEoB,OAFpB,EAE6B;AAAA,WAAMF,IAAI,CAACR,SAAL,CAAemC,GAAf,CAAmB,UAAnB,CAAN;AAAA,GAF7B,CADW;AAAA,CAFf;;AAQA,SAASd,cAAT,CAAwBoB,IAAxB,EAA8BT,OAA9B,EAAuC;AACrC,MAAMU,GAAG,GAAG5C,QAAQ,CAAC6C,aAAT,CAAuB,MAAvB,CAAZ;AACA,MAAMC,YAAY,GAAG9C,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAArB;AAEA2C,EAAAA,GAAG,CAAC1C,SAAJ,CAAcmC,GAAd,CAAkB,UAAlB,EAA8B,KAA9B,eAA2CM,IAA3C,GAAmD,WAAnD;AACAC,EAAAA,GAAG,CAACN,SAAJ,GAAgBJ,OAAhB;AACAY,EAAAA,YAAY,CAACC,WAAb,CAAyBH,GAAzB;AAEAI,EAAAA,UAAU,CAAC;AAAA,WAAMJ,GAAG,CAAC1C,SAAJ,CAAcmC,GAAd,CAAkB,QAAlB,CAAN;AAAA,GAAD,CAAV;AACAW,EAAAA,UAAU,CACR;AAAA,WAAMF,YAAY,CAACG,iBAAb,CAA+B/C,SAA/B,CAAyCC,MAAzC,CAAgD,QAAhD,CAAN;AAAA,GADQ,EAER,IAFQ,CAAV;AAIA6C,EAAAA,UAAU,CACR;AAAA,WAAMF,YAAY,CAACI,WAAb,CAAyBJ,YAAY,CAACG,iBAAtC,CAAN;AAAA,GADQ,EAER,IAFQ,CAAV;AAID;;AAED,SAASnD,aAAT,GAAyB;AACvB,MAAI,OAAOH,IAAI,CAACwD,UAAZ,KAA2B,WAA/B,EAA4C;AAC1C;AACD;;AAEDxD,EAAAA,IAAI,CACDwD,UADH,GAEGC,IAFH,CAEQ,UAAAC,OAAO,EAAI;AAAA,QACPC,WADO,GACqBD,OADrB,CACPC,WADO;AAAA,QACMC,UADN,GACqBF,OADrB,CACME,UADN;AAEf,QAAMC,eAAe,GAAGxD,QAAQ,CAACgC,aAAT,CAAuB,oBAAvB,CAAxB;AACA,QAAMyB,eAAe,GAAGzD,QAAQ,CAACC,cAAT,CAAwB,eAAxB,CAAxB;AACA,QAAMyD,YAAY,GAAG1D,QAAQ,CAACC,cAAT,CAAwB,cAAxB,CAArB;AAEAyD,IAAAA,YAAY,CAACC,WAAb,GAA2BL,WAA3B;AACAG,IAAAA,eAAe,CAACvD,SAAhB,CAA0BC,MAA1B,CAAiC,cAAjC;AACAqD,IAAAA,eAAe,CAACI,GAAhB,GAAsBL,UAAtB;AACAC,IAAAA,eAAe,CAACtD,SAAhB,CAA0BC,MAA1B,CAAiC,cAAjC;AACD,GAZH,EAaG0D,KAbH,CAaS,UAAA9D,GAAG,EAAI;AACZqB,IAAAA,OAAO,CAACC,GAAR,CAAYtB,GAAZ;AACD,GAfH;AAgBD","file":"index.map","sourceRoot":"../src/client","sourcesContent":["const parseManyFieldNames = (fields, starterObj = {}, delimiter = \"_\") =>\r\n  fields.reduce(\r\n    (obj, field) => parseFieldName(field, obj),\r\n    starterObj,\r\n    delimiter\r\n  );\r\n\r\nconst parseFieldName = (field, starterObj = {}, delimiter = \"_\") => {\r\n  const { name, value } = field;\r\n  const splittedName = name.split(delimiter);\r\n  // Remove form id\r\n  const keys = splittedName.slice(1);\r\n\r\n  keys.reduce((obj, key, index) => {\r\n    const isLastIndex = !keys[index + 1] ? true : false;\r\n\r\n    if (Array.isArray(obj) && isNaN(parseInt(key))) {\r\n      throw new Error(\r\n        \"The key preceded by array must be a numeric value, \" + key + \" given.\"\r\n      );\r\n    }\r\n\r\n    if (isLastIndex) {\r\n      return handleLastIndex(obj, key, value);\r\n    }\r\n\r\n    // Keyname ends with bracket\r\n    const valueShouldBeArray = key.slice(-2) === \"[]\";\r\n\r\n    if (valueShouldBeArray) {\r\n      return handleArrayProperty(obj, key);\r\n    }\r\n\r\n    return handleNormal(obj, key);\r\n  }, starterObj);\r\n\r\n  return starterObj;\r\n};\r\n\r\n/**\r\n * *****\r\n * HELPER FUNCTIONS\r\n * *****\r\n */\r\nconst handleLastIndex = (obj, key, value) => {\r\n  obj[key] = value;\r\n\r\n  return obj;\r\n};\r\nconst handleArrayProperty = (obj, key) => {\r\n  // Remove bracket from keyname then assign new array to it.\r\n  const slicedKey = key.slice(0, -2);\r\n  const prop = obj[slicedKey];\r\n\r\n  // If prop already exists, skip the loop\r\n  // to prevent data overwriting.\r\n  if (isPropExists(obj, slicedKey)) {\r\n    return prop;\r\n  }\r\n\r\n  obj[slicedKey] = [];\r\n\r\n  return obj[slicedKey];\r\n};\r\nconst handleNormal = (obj, key) => {\r\n  // If prop already exists, skip the loop\r\n  // to prevent data overwriting.\r\n  if (isPropExists(obj, key)) {\r\n    return obj[key];\r\n  }\r\n\r\n  // If key is not expected to be array\r\n  // and not the last item, assign new object to it.\r\n  obj[key] = {};\r\n\r\n  return obj[key];\r\n};\r\nconst isPropExists = (obj, key) => typeof obj[key] !== \"undefined\";\r\n\r\nexport { parseFieldName, parseManyFieldNames };\r\n","import * as fieldNameParser from \"./fieldNameParser\";\r\n\r\n// Initialize LIFF SDK\r\nwindow.onload = () => {\r\n  liff.init(\r\n    data => initProfileUi(),\r\n    err => {\r\n      // Show user profile as 'Anonymous'\r\n      document.getElementById(\"user-greeting\").classList.remove(\"is-invisible\");\r\n      // Show warning message about LIFF.\r\n      document\r\n        .getElementById(\"warn-message-wrapper\")\r\n        .classList.remove(\"collapse\");\r\n    }\r\n  );\r\n};\r\n\r\n// Handle all forms submission.\r\ndocument.querySelectorAll(\"form\").forEach(function handleEachForm(form) {\r\n  const fields = [...form.elements].filter(elem => elem.tagName !== \"BUTTON\");\r\n\r\n  // Validate form on field input\r\n  fields.forEach(field =>\r\n    field.addEventListener(\"input\", e => validateField(e.target))\r\n  );\r\n\r\n  // Handle form submission.\r\n  form.addEventListener(\"submit\", function(e) {\r\n    e.preventDefault();\r\n\r\n    fields.forEach(validateField);\r\n\r\n    if (!this.checkValidity()) {\r\n      return;\r\n    }\r\n\r\n    const liffMessageData = fieldNameParser.parseManyFieldNames(fields);\r\n\r\n    console.log(\"The form is submitted!\");\r\n    console.log(\"liffMessageData: \", liffMessageData);\r\n\r\n    if (typeof liff.sendMessages === \"undefined\") {\r\n      createResponse(\"warning\", \"Could not send message!\");\r\n\r\n      return;\r\n    }\r\n\r\n    liff.sendMessages(messages[node.dataset.messageType]);\r\n    createResponse(\"success\", \"Message sent!\");\r\n  });\r\n});\r\n\r\n// Should separate concern\r\nfunction validateField(field) {\r\n  const { validity, validationMessage } = field;\r\n  const messageDom = field.parentElement.parentElement.querySelector(\r\n    \".builtin-message\"\r\n  );\r\n\r\n  if (!validity.valid) {\r\n    const message = validity.patternMismatch\r\n      ? field.dataset.errorMessagePattern\r\n      : validationMessage;\r\n\r\n    field.classList.remove(\"is-success\");\r\n    field.classList.add(\"is-danger\");\r\n    messageDom.innerHTML = message || validationMessage;\r\n\r\n    return true;\r\n  } else {\r\n    field.classList.remove(\"is-danger\");\r\n    field.classList.add(\"is-success\");\r\n    messageDom.innerHTML = \"\";\r\n\r\n    return false;\r\n  }\r\n}\r\n\r\n// Toggle field description panel when field info icon is clicked.\r\ndocument.querySelectorAll(\"form .field .description-icon\").forEach(elem =>\r\n  elem.addEventListener(\"click\", function() {\r\n    console.log(\"description icon clicked!\");\r\n    const notiDom = document.querySelector(\r\n      `form .field .field-description[data-for=${this.dataset.for}]`\r\n    );\r\n    const method = notiDom.classList.contains(\"collapse\") ? \"remove\" : \"add\";\r\n\r\n    notiDom.classList[method](\"collapse\");\r\n  })\r\n);\r\n\r\n// Close field description when delete icon is clicked.\r\ndocument\r\n  .querySelectorAll(\"form .field .field-description\")\r\n  .forEach(elem =>\r\n    elem\r\n      .querySelector(\".delete\")\r\n      .addEventListener(\"click\", () => elem.classList.add(\"collapse\"))\r\n  );\r\n\r\nfunction createResponse(type, message) {\r\n  const dom = document.createElement(\"span\");\r\n  const responsesBox = document.getElementById(\"responses\");\r\n\r\n  dom.classList.add(\"response\", \"tag\", `is-${type}`, \"is-medium\");\r\n  dom.innerHTML = message;\r\n  responsesBox.appendChild(dom);\r\n\r\n  setTimeout(() => dom.classList.add(\"active\"));\r\n  setTimeout(\r\n    () => responsesBox.firstElementChild.classList.remove(\"active\"),\r\n    3000\r\n  );\r\n  setTimeout(\r\n    () => responsesBox.removeChild(responsesBox.firstElementChild),\r\n    3800\r\n  );\r\n}\r\n\r\nfunction initProfileUi() {\r\n  if (typeof liff.getProfile === \"undefined\") {\r\n    return;\r\n  }\r\n\r\n  liff\r\n    .getProfile()\r\n    .then(profile => {\r\n      const { displayName, pictureUrl } = profile;\r\n      const profileImageDom = document.querySelector(\"#profile-image img\");\r\n      const userGreetingDom = document.getElementById(\"user-greeting\");\r\n      const profileNameP = document.getElementById(\"profile-name\");\r\n\r\n      profileNameP.textContent = displayName;\r\n      userGreetingDom.classList.remove(\"is-invisible\");\r\n      profileImageDom.src = pictureUrl;\r\n      profileImageDom.classList.remove(\"is-invisible\");\r\n    })\r\n    .catch(err => {\r\n      console.log(err);\r\n    });\r\n}\r\n"]}